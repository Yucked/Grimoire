@page "/sources"
@using Grimoire.Handlers
@using Grimoire.Sources.Interfaces

@inject DatabaseHandler DatabaseHandler
@inject NavigationManager NavigationManager

<div class="container p-4">
    @if (_sources == null || !_sources.Any()) {
        <Waiting Message="Loading sources"/>
    }
    else {
        <div class="border rounded-4 shadow">
            <ul class="list-group list-group-flush">
                @foreach (var source in _sources) {
                    <a class="list-group-item list-group-item-action" @onclick="() => NavTo(source.Id)">
                        <img src="@DatabaseHandler.GetSourceIcon(source.Id)" class="img-thumbnail" alt="@source.Name" width="70">
                        <span>@source.Name</span>
                    </a>
                }
            </ul>
        </div>
    }
</div>

@code {
    private IReadOnlyList<IGrimoireSource> _sources;

    protected override async Task OnInitializedAsync() {
        _sources = await DatabaseHandler.ListSourcesAsync();
    }

    private void NavTo(string sourceId) {
        NavigationManager.NavigateTo($"/sources/{sourceId}");
    }

}